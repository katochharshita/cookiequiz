<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Help the CookieBot 2.0 guess your favourite Cookie</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #6c5ce7 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2d3436;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }

        .language-bar {
            background: linear-gradient(135deg, #e8f4f8 0%, #dfe6e9 100%);
            padding: 15px 30px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            border-bottom: 2px solid #0984e3;
        }

        .language-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .language-selector label {
            font-size: 0.95em;
            color: #636e72;
            font-weight: 600;
        }

        .language-selector select {
            padding: 10px 20px;
            font-size: 0.95em;
            border: 2px solid #0984e3;
            border-radius: 15px;
            background: white;
            color: #2d3436;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 150px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .language-selector select:hover {
            background: #e8f4f8;
            border-color: #6c5ce7;
            box-shadow: 0 4px 12px rgba(9, 132, 227, 0.2);
            transform: translateY(-2px);
        }

        .language-selector select:focus {
            outline: none;
            border-color: #0984e3;
            box-shadow: 0 4px 12px rgba(9, 132, 227, 0.3);
        }

        .screen {
            display: none;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            color: #0984e3;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: 1.2em;
            color: #636e72;
        }

        /* Screen 1: Supermarket Selection (with privacy indicators) */
        .supermarkets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .supermarket-card {
            background: linear-gradient(135deg, #e8f4f8 0%, #dfe6e9 100%);
            border: 4px solid #0984e3;
            border-radius: 20px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }

        .supermarket-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(9, 132, 227, 0.3);
            border-color: #6c5ce7;
        }

        .supermarket-card.selected {
            border-color: #6c5ce7;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(9, 132, 227, 0.4);
        }

        .supermarket-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .supermarket-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #0984e3;
            margin-bottom: 10px;
        }

        .supermarket-card.selected .supermarket-name {
            color: white;
        }

        .supermarket-desc {
            font-size: 1em;
            color: #636e72;
        }

        .supermarket-card.selected .supermarket-desc {
            color: rgba(255, 255, 255, 0.9);
        }

        /* Privacy indicator on ingredients */
        .privacy-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #00b894;
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }

        /* Screen 2: Ingredient Selection (with lock icons) */
        .ingredients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .ingredient-card {
            background: linear-gradient(135deg, #e8f4f8 0%, #dfe6e9 100%);
            border: 3px solid #0984e3;
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }

        .ingredient-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(9, 132, 227, 0.3);
        }

        .ingredient-card.selected {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            border-color: #6c5ce7;
            color: white;
        }

        .lock-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 1.2em;
        }

        .ingredient-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .ingredient-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .ingredient-details {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .privacy-tooltip {
            background: #00b894;
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9em;
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid #00b894;
        }

        .selection-counter {
            text-align: center;
            font-size: 1.3em;
            color: #0984e3;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 15px;
            background: #e8f4f8;
            border-radius: 15px;
        }

        /* Screen 2: Encrypted Data Display */
        .data-display {
            background: #2d3436;
            color: #00b894;
            padding: 25px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin-bottom: 30px;
            overflow-x: auto;
            white-space: pre-wrap;
            border: 3px solid #00b894;
        }

        .privacy-explanation {
            background: linear-gradient(135deg, #e8f4f8 0%, #dfe6e9 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #0984e3;
        }

        .privacy-explanation h3 {
            color: #0984e3;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .privacy-explanation p {
            color: #2d3436;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .progress-section {
            margin-bottom: 30px;
        }

        .progress-label {
            font-size: 1.3em;
            color: #2d3436;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #dfe6e9;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0984e3 0%, #6c5ce7 100%);
            border-radius: 15px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Screen 3: Limited Insights */
        .insights-container {
            margin-bottom: 30px;
        }

        .insight-section {
            margin-bottom: 30px;
        }

        .insight-section h3 {
            color: #0984e3;
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .insight-item {
            background: linear-gradient(135deg, #e8f4f8 0%, #dfe6e9 100%);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 12px;
            border-left: 5px solid #0984e3;
            animation: slideInLeft 0.5s ease-out;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .insight-item.negative {
            border-left-color: #e17055;
            background: linear-gradient(135deg, #fff5e6 0%, #ffeaa7 100%);
        }

        .insight-item.positive {
            border-left-color: #00b894;
            background: linear-gradient(135deg, #d5f4e6 0%, #a8e6cf 100%);
        }

        .insight-item strong {
            color: #0984e3;
            font-size: 1.1em;
        }

        .insight-item.negative strong {
            color: #e17055;
        }

        .insight-item.positive strong {
            color: #00b894;
        }

        .result-box {
            background: linear-gradient(135deg, #e8f4f8 0%, #dfe6e9 100%);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 3px solid #0984e3;
            margin-bottom: 30px;
        }

        .celebration {
            font-size: 4em;
            margin-bottom: 15px;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }

        .result-title {
            font-size: 2em;
            color: #0984e3;
            margin-bottom: 10px;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #0984e3 0%, #6c5ce7 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(9, 132, 227, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #dfe6e9 0%, #b2bec3 100%);
            color: #2d3436;
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(178, 190, 195, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 2em;
            }
            .supermarkets {
                grid-template-columns: 1fr;
            }
            .ingredients-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            .language-bar {
                padding: 12px 20px;
            }
            .language-selector {
                flex-direction: column;
                align-items: flex-end;
                gap: 8px;
            }
            .language-selector label {
                font-size: 0.85em;
            }
            .language-selector select {
                padding: 8px 15px;
                font-size: 0.85em;
                min-width: 130px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="language-bar">
            <div class="language-selector">
                <label for="language-selector">üåê Language:</label>
                <select id="language-selector">
                    <option value="en">üá¨üáß English</option>
                    <option value="de">üá©üá™ Deutsch</option>
                    <option value="es">üá™üá∏ Espa√±ol</option>
                    <option value="pt">üáµüáπ Portugu√™s</option>
                </select>
            </div>
        </div>
        <!-- Screen 1: Choose Supermarket -->
        <div class="screen active" id="screen1">
            <div class="header">
                <h1 data-translate="title">Help the CookieBot 2.0 guess your favourite Cookie</h1>
                <p style="margin-top: 10px; font-size: 1em;" data-translate="subtitle">First Let us collect your favourite ingredients. Go to the different supermarkets and buy any 5 ingredients you would like in your cookie.</p>
            </div>
            <div class="supermarkets" id="supermarkets">
                <!-- Supermarkets will be populated by JS -->
            </div>
            <div class="nav-buttons">
                <button class="btn btn-primary" id="next1" disabled data-translate="next">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 2: Choose Ingredients (with privacy indicators) -->
        <div class="screen" id="screen2">
            <div class="header">
                <h1 data-translate="chooseIngredients">üõí Choose 5 Ingredients</h1>
                <p id="supermarket-name-display"></p>
            </div>
            <div class="privacy-tooltip" data-translate="privacyTooltip">
                üîê Your ingredient data is encrypted and stored locally!
            </div>
            <div class="selection-counter" id="counter" data-translate="selected">
                Selected: 0 / 5
            </div>
            <div class="ingredients-grid" id="ingredients">
                <!-- Ingredients will be populated by JS -->
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" id="back2" data-translate="goBack">‚Üê Go Back</button>
                <button class="btn btn-primary" id="next2" disabled data-translate="next">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 3: Encrypted Data Display -->
        <div class="screen" id="screen3">
            <div class="header">
                <h1 data-translate="dataSent2">üì° Data Sent to CookieBot 2.0</h1>
                <p data-translate="privacyData">Privacy-preserved data only...</p>
            </div>
            
            <div class="privacy-explanation">
                <p data-translate="privacyExplanation">CookieBot cannot see inside your ingredient bag so it does not have any additional info about the ingredient. Also, Ingredient counts have been fuzzed so the CookieBot only sees ranges, not exact values.</p>
            </div>
            
            <div class="data-display" id="data-display">
                <!-- Encrypted data will be displayed here -->
            </div>
            
            <div class="progress-section">
                <div class="progress-label">üìä Data Collected:</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill">8%</div>
                </div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn btn-secondary" id="back3" data-translate="goBack">‚Üê Go Back</button>
                <button class="btn btn-primary" id="next3" data-translate="seeInsights">See Insights ‚Üí</button>
            </div>
        </div>

        <!-- Screen 4: Limited Insights -->
        <div class="screen" id="screen4">
            <div class="header">
                <h1 data-translate="analysis2">ü§ñ CookieBot 2.0's Analysis</h1>
                <p data-translate="learned">What CookieBot learned about you...</p>
            </div>
            
            <div class="result-box">
                <div class="celebration">üéâ</div>
                <div class="result-title" id="cookie-result" data-translate="cookieType">Your Cookie Type: Loading...</div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn btn-secondary" id="back4" data-translate="goBack">‚Üê Go Back</button>
                <button class="btn btn-primary" id="restart" data-translate="restart">üîÑ Restart Quiz</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // QUIZ 2: CookieBot 2.0 Shop Safely (Privacy-Preserving)
        // ============================================

        // Translation system
        const translations = {
            en: {
                title: "Help the CookieBot 2.0 guess your favourite Cookie",
                subtitle: "First Let us collect your favourite ingredients. Go to the different supermarkets and buy any 5 ingredients you would like in your cookie.",
                next: "Next ‚Üí",
                goBack: "‚Üê Go Back",
                chooseIngredients: "üõí Choose 5 Ingredients",
                selected: "Selected: 0 / 5",
                shoppingAt: "Shopping at",
                privacyTooltip: "üîê Your ingredient data is encrypted and stored locally!",
                dataSent2: "üì° Data Sent to CookieBot 2.0",
                privacyData: "Privacy-preserved data only...",
                privacyExplanation: "CookieBot cannot see inside your ingredient bag so it does not have any additional info about the ingredient. Also, Ingredient counts have been fuzzed so the CookieBot only sees ranges, not exact values.",
                dataCollected: "üìä Data Collected:",
                seeInsights: "See Insights ‚Üí",
                analysis2: "ü§ñ CookieBot 2.0's Analysis",
                learned: "What CookieBot learned about you...",
                cookieType: "Your Cookie Type:",
                loading: "Loading...",
                restart: "üîÑ Restart Quiz",
                youCanOnlySelect: "You can only select 5 ingredients!"
            },
            de: {
                title: "Hilf dem CookieBot 2.0, dein Lieblingskeks zu erraten",
                subtitle: "Zuerst sammeln wir deine Lieblingszutaten. Gehe zu den verschiedenen Superm√§rkten und kaufe 5 Zutaten, die du in deinem Keks haben m√∂chtest.",
                next: "Weiter ‚Üí",
                goBack: "‚Üê Zur√ºck",
                chooseIngredients: "üõí W√§hle 5 Zutaten",
                selected: "Ausgew√§hlt: 0 / 5",
                shoppingAt: "Einkaufen bei",
                privacyTooltip: "üîê Deine Zutatendaten sind verschl√ºsselt und lokal gespeichert!",
                dataSent2: "üì° An CookieBot 2.0 gesendete Daten",
                privacyData: "Nur datenschutzgesch√ºtzte Daten...",
                privacyExplanation: "CookieBot kann nicht in deine Zutaten-Tasche sehen und hat daher keine zus√§tzlichen Informationen √ºber die Zutaten. Au√üerdem wurden die Zutatenanzahlen verschleiert, sodass CookieBot nur Bereiche sieht, keine genauen Werte.",
                dataCollected: "üìä Gesammelte Daten:",
                seeInsights: "Einblicke anzeigen ‚Üí",
                analysis2: "ü§ñ CookieBot 2.0's Analyse",
                learned: "Was CookieBot √ºber dich gelernt hat...",
                cookieType: "Dein Kekstyp:",
                loading: "L√§dt...",
                restart: "üîÑ Quiz neu starten",
                youCanOnlySelect: "Du kannst nur 5 Zutaten ausw√§hlen!"
            },
            es: {
                title: "Ayuda al CookieBot 2.0 a adivinar tu galleta favorita",
                subtitle: "Primero recopilemos tus ingredientes favoritos. Ve a los diferentes supermercados y compra 5 ingredientes que te gustar√≠a tener en tu galleta.",
                next: "Siguiente ‚Üí",
                goBack: "‚Üê Volver",
                chooseIngredients: "üõí Elige 5 Ingredientes",
                selected: "Seleccionado: 0 / 5",
                shoppingAt: "Comprando en",
                privacyTooltip: "üîê ¬°Tus datos de ingredientes est√°n encriptados y almacenados localmente!",
                dataSent2: "üì° Datos Enviados a CookieBot 2.0",
                privacyData: "Solo datos protegidos por privacidad...",
                privacyExplanation: "CookieBot no puede ver dentro de tu bolsa de ingredientes, por lo que no tiene informaci√≥n adicional sobre el ingrediente. Adem√°s, los conteos de ingredientes han sido difuminados para que CookieBot solo vea rangos, no valores exactos.",
                dataCollected: "üìä Datos Recopilados:",
                seeInsights: "Ver Informaci√≥n ‚Üí",
                analysis2: "ü§ñ An√°lisis de CookieBot 2.0",
                learned: "Lo que CookieBot aprendi√≥ sobre ti...",
                cookieType: "Tu Tipo de Galleta:",
                loading: "Cargando...",
                restart: "üîÑ Reiniciar Quiz",
                youCanOnlySelect: "¬°Solo puedes seleccionar 5 ingredientes!"
            },
            pt: {
                title: "Ajude o CookieBot 2.0 a adivinhar seu biscoito favorito",
                subtitle: "Primeiro vamos coletar seus ingredientes favoritos. V√° aos diferentes supermercados e compre 5 ingredientes que voc√™ gostaria de ter no seu biscoito.",
                next: "Pr√≥ximo ‚Üí",
                goBack: "‚Üê Voltar",
                chooseIngredients: "üõí Escolha 5 Ingredientes",
                selected: "Selecionado: 0 / 5",
                shoppingAt: "Comprando em",
                privacyTooltip: "üîê Seus dados de ingredientes est√£o criptografados e armazenados localmente!",
                dataSent2: "üì° Dados Enviados ao CookieBot 2.0",
                privacyData: "Apenas dados protegidos por privacidade...",
                privacyExplanation: "CookieBot n√£o pode ver dentro da sua bolsa de ingredientes, ent√£o n√£o tem informa√ß√µes adicionais sobre o ingrediente. Al√©m disso, as contagens de ingredientes foram ofuscadas para que o CookieBot veja apenas intervalos, n√£o valores exatos.",
                dataCollected: "üìä Dados Coletados:",
                seeInsights: "Ver Informa√ß√µes ‚Üí",
                analysis2: "ü§ñ An√°lise do CookieBot 2.0",
                learned: "O que o CookieBot aprendeu sobre voc√™...",
                cookieType: "Seu Tipo de Biscoito:",
                loading: "Carregando...",
                restart: "üîÑ Reiniciar Quiz",
                youCanOnlySelect: "Voc√™ s√≥ pode selecionar 5 ingredientes!"
            }
        };

        let currentLanguage = 'en';

        // Translation function
        function translate(key) {
            return translations[currentLanguage][key] || translations.en[key] || key;
        }

        // Update all text elements
        function updateLanguage() {
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (element.tagName === 'BUTTON' || element.tagName === 'H1' || element.tagName === 'P' || element.tagName === 'DIV') {
                    if (key === 'selected') {
                        const count = selectedIngredients.length;
                        element.textContent = translate('selected').replace('0', count);
                    } else {
                        element.textContent = translate(key);
                    }
                }
            });
            
            // Update title
            document.title = translate('title');
            
            // Update dynamic content
            if (selectedSupermarket) {
                const market = supermarkets[selectedSupermarket];
                document.getElementById('supermarket-name-display').textContent = `${translate('shoppingAt')} ${market.name}`;
            }
        }

        // Same supermarket data as Quiz 1
        const supermarkets = {
            budgetmart: {
                name: "Lidl",
                icon: "üè™",
                ingredients: [
                    { name: "Butter", brand: "ValueBrand", price: 2.50, icon: "üßà", category: "Dairy" },
                    { name: "Chocolate Chips", brand: "BargainBite", price: 1.99, icon: "üç´", category: "Baking" },
                    { name: "Sugar", brand: "SweetDeal", price: 1.25, icon: "üç¨", category: "Baking" },
                    { name: "Flour", brand: "BasicBake", price: 1.50, icon: "üåæ", category: "Baking" },
                    { name: "Eggs", brand: "FarmFresh", price: 2.00, icon: "ü•ö", category: "Dairy" },
                    { name: "Vanilla Extract", brand: "SimpleSpice", price: 2.25, icon: "üåø", category: "Spices" },
                    { name: "Baking Soda", brand: "CheapChem", price: 0.99, icon: "‚öóÔ∏è", category: "Baking" },
                    { name: "Salt", brand: "TableSalt", price: 0.75, icon: "üßÇ", category: "Spices" }
                ]
            },
            freshfield: {
                name: "Wasgau",
                icon: "üåø",
                ingredients: [
                    { name: "Organic Butter", brand: "GreenCow", price: 5.80, icon: "üßà", category: "Dairy" },
                    { name: "Fair-Trade Chocolate", brand: "ChocoPure", price: 3.80, icon: "üç´", category: "Baking" },
                    { name: "Cane Sugar", brand: "NatureSweet", price: 4.50, icon: "üç¨", category: "Baking" },
                    { name: "Organic Flour", brand: "WholeGrain", price: 3.25, icon: "üåæ", category: "Baking" },
                    { name: "Free-Range Eggs", brand: "HappyHen", price: 5.00, icon: "ü•ö", category: "Dairy" },
                    { name: "Vanilla Bean", brand: "PureSpice", price: 6.50, icon: "üåø", category: "Spices" },
                    { name: "Himalayan Salt", brand: "MountainSalt", price: 3.75, icon: "üßÇ", category: "Spices" },
                    { name: "Coconut Oil", brand: "TropicalPure", price: 4.25, icon: "ü••", category: "Oils" }
                ]
            },
            megastore: {
                name: "Edeka",
                icon: "üè∞",
                ingredients: [
                    { name: "European Butter", brand: "GourmetGold", price: 8.50, icon: "üßà", category: "Dairy" },
                    { name: "Belgian Chocolate", brand: "ChocoLuxe", price: 12.00, icon: "üç´", category: "Baking" },
                    { name: "Demerara Sugar", brand: "CrystalPure", price: 7.50, icon: "üç¨", category: "Baking" },
                    { name: "Artisan Flour", brand: "MillCraft", price: 6.75, icon: "üåæ", category: "Baking" },
                    { name: "Duck Eggs", brand: "EliteFarm", price: 9.00, icon: "ü•ö", category: "Dairy" },
                    { name: "Madagascar Vanilla", brand: "PremiumSpice", price: 15.00, icon: "üåø", category: "Spices" },
                    { name: "Fleur de Sel", brand: "SeaSaltElite", price: 8.00, icon: "üßÇ", category: "Spices" },
                    { name: "Truffle Oil", brand: "LuxuryTaste", price: 25.00, icon: "üçÑ", category: "Oils" }
                ]
            }
        };

        // Quiz state
        let selectedSupermarket = null;
        let selectedIngredients = [];
        let currentScreen = 1;

        // Cookie type mapping
        const cookieTypes = {
            chocolate: "Chocolate Hero Cookie üç´",
            strawberry: "Strawberry Dream Cookie üçì",
            vanilla: "Classic Vanilla Cookie üç™",
            peanut: "Peanut Power Cookie ü•ú",
            default: "Cinnamon Dream Cookie üç™"
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderSupermarkets();
            setupEventListeners();
            
            // Language selector
            document.getElementById('language-selector').addEventListener('change', function(e) {
                currentLanguage = e.target.value;
                updateLanguage();
                // Re-render current screen content
                if (currentScreen === 1) {
                    renderSupermarkets();
                } else if (currentScreen === 2) {
                    renderIngredients();
                } else if (currentScreen === 3) {
                    displayEncryptedData();
                } else if (currentScreen === 4) {
                    generateLimitedInsights();
                }
            });
            
            updateLanguage();
        });

        // Screen 1: Render supermarkets
        function renderSupermarkets() {
            const container = document.getElementById('supermarkets');
            container.innerHTML = '';
            
            Object.keys(supermarkets).forEach(key => {
                const market = supermarkets[key];
                const card = document.createElement('div');
                card.className = 'supermarket-card';
                card.dataset.market = key;
                card.innerHTML = `
                    <div class="supermarket-icon">${market.icon}</div>
                    <div class="supermarket-name">${market.name}</div>
                `;
                card.addEventListener('click', () => selectSupermarket(key));
                container.appendChild(card);
            });
        }

        function selectSupermarket(key) {
            selectedSupermarket = key;
            document.querySelectorAll('.supermarket-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-market="${key}"]`).classList.add('selected');
            document.getElementById('next1').disabled = false;
        }

        // Screen 2: Render ingredients with privacy indicators
        function renderIngredients() {
            if (!selectedSupermarket) return;
            
            const market = supermarkets[selectedSupermarket];
            const container = document.getElementById('ingredients');
            container.innerHTML = '';
            
            document.getElementById('supermarket-name-display').textContent = `${translate('shoppingAt')} ${market.name}`;
            
            market.ingredients.forEach((ingredient, index) => {
                const card = document.createElement('div');
                card.className = 'ingredient-card';
                card.dataset.index = index;
                card.innerHTML = `
                    <div class="lock-icon">üîí</div>
                    <div class="ingredient-icon">${ingredient.icon}</div>
                    <div class="ingredient-name">${ingredient.name}</div>
                    <div class="ingredient-details">${ingredient.brand} - $${ingredient.price.toFixed(2)}</div>
                `;
                card.addEventListener('click', () => toggleIngredient(ingredient, card));
                container.appendChild(card);
            });
            
            updateCounter();
        }

        function toggleIngredient(ingredient, card) {
            const index = selectedIngredients.findIndex(item => 
                item.name === ingredient.name && item.brand === ingredient.brand
            );
            
            if (index > -1) {
                selectedIngredients.splice(index, 1);
                card.classList.remove('selected');
            } else {
                if (selectedIngredients.length < 5) {
                    selectedIngredients.push(ingredient);
                    card.classList.add('selected');
                } else {
                    alert(translate('youCanOnlySelect'));
                }
            }
            
            updateCounter();
        }

        function updateCounter() {
            const count = selectedIngredients.length;
            document.getElementById('counter').textContent = translate('selected').replace('0', count);
            document.getElementById('next2').disabled = count !== 5;
        }

        // Screen 3: Display encrypted/minimal data
        function displayEncryptedData() {
            if (!selectedSupermarket || selectedIngredients.length === 0) return;
            
            // Extract ingredient names only (no brand, price, etc.)
            const ingredientNames = selectedIngredients.map(item => {
                // Simplify names (remove "Organic", "Fair-Trade", etc. for privacy)
                return item.name.replace(/Organic|Fair-Trade|European|Belgian|Madagascar|Himalayan|Artisan|Premium|Elite|Gourmet|Luxury/gi, '').trim();
            });
            
            // Create fuzzed counts using differential privacy simulation
            const countsDP = {};
            ingredientNames.forEach(name => {
                const baseName = name.split(' ')[0]; // Get base ingredient name
                if (!countsDP[baseName]) {
                    // Fuzz the count: show range instead of exact number
                    const actualCount = ingredientNames.filter(n => n.includes(baseName)).length;
                    // Add noise: show range ¬±1
                    const min = Math.max(0, actualCount - 1);
                    const max = actualCount + 1;
                    countsDP[baseName] = `${min}‚Äì${max}`;
                }
            });
            
            const encryptedData = {
                ingredientsEncrypted: ingredientNames,
                countsDP: countsDP,
                note: "All personal identifiers (brand, price, supermarket, time) have been removed"
            };
            
            document.getElementById('data-display').textContent = JSON.stringify(encryptedData, null, 2);
            
            // Animate progress bar to 8%
            setTimeout(() => {
                document.getElementById('progress-fill').style.width = '8%';
            }, 500);
        }

        // Screen 4: Generate limited insights
        function generateLimitedInsights() {
            if (!selectedSupermarket || selectedIngredients.length === 0) return;
            
            // Determine cookie type based on ingredient types
            const hasChocolate = selectedIngredients.some(item => 
                item.name.toLowerCase().includes('chocolate')
            );
            const hasStrawberry = selectedIngredients.some(item => 
                item.name.toLowerCase().includes('strawberry')
            );
            const hasVanilla = selectedIngredients.some(item => 
                item.name.toLowerCase().includes('vanilla')
            );
            const hasPeanut = selectedIngredients.some(item => 
                item.name.toLowerCase().includes('peanut')
            );
            
            // Determine cookie type
            let cookieType = cookieTypes.default;
            if (hasChocolate) {
                cookieType = cookieTypes.chocolate;
            } else if (hasStrawberry) {
                cookieType = cookieTypes.strawberry;
            } else if (hasPeanut) {
                cookieType = cookieTypes.peanut;
            } else if (hasVanilla) {
                cookieType = cookieTypes.vanilla;
            }
            
            // Display cookie type
            document.getElementById('cookie-result').textContent = `üéâ ${translate('cookieType')} ${cookieType}`;
        }

        // Navigation functions
        function showScreen(screenNum) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(`screen${screenNum}`).classList.add('active');
            currentScreen = screenNum;
            
            if (screenNum === 2) {
                renderIngredients();
            } else if (screenNum === 3) {
                displayEncryptedData();
            } else if (screenNum === 4) {
                generateLimitedInsights();
            }
        }

        function setupEventListeners() {
            document.getElementById('next1').addEventListener('click', () => {
                if (selectedSupermarket) showScreen(2);
            });
            
            document.getElementById('back2').addEventListener('click', () => showScreen(1));
            document.getElementById('next2').addEventListener('click', () => {
                if (selectedIngredients.length === 5) showScreen(3);
            });
            
            document.getElementById('back3').addEventListener('click', () => showScreen(2));
            document.getElementById('next3').addEventListener('click', () => showScreen(4));
            
            document.getElementById('back4').addEventListener('click', () => showScreen(3));
            document.getElementById('restart').addEventListener('click', () => {
                selectedSupermarket = null;
                selectedIngredients = [];
                document.getElementById('progress-fill').style.width = '0%';
                showScreen(1);
                renderSupermarkets();
            });
        }
    </script>
</body>
</html>

